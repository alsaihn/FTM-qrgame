<h2>Registering</h2>

<form action="/register/{{badge_number}}/" method="post">{% csrf_token %}
  <p>Badge number: {{ badge_number }}</p>
  {{ form.as_p }}
  <p>Pick an image password:</p>
  <table>
  {% for im in images %}
      {% if not forloop.counter|divisibleby:"2" %}
      <tr>
      {% endif %}
      <td>
        <input type="radio" name="animals" id="{{ im.name }}" />
        <img id="{{ im.name }}" src="{{ im.src }}" title="{{im.name}}" height=75 />
      </td>
      {% if forloop.counter|divisibleby:"2" %}
      </tr>
      {% endif %}
  {% endfor %}
  </table>
  <input type="submit" value="Submit" />
</form>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript">

function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}

  $("img").click(function(evt) {
    var animal = this.id;
    $("input#" + animal).prop('checked', true).change();
  });

  $("input[name=animals]:radio").change(function () {
    var animal = this.id;
    $("#id_image").val(animal);
  })

  var action = $("form").prop('action');
  action = action + "?next=" + getQueryVariable("next");
  $("form").prop('action', action);

</script>

